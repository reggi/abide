<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for dep-merge/index.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">dep-merge/</a> index.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>36/36</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>11/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>29/29</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>30/30</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">#!/usr/bin/env node
import fs from 'fs-extra'
import path from 'path'
import journey from '@reggi/journey'
import fileExists from '@reggi/pkg.file-exists'
&nbsp;
const BLOCK = 'temporary-file:deletion-prevention'
const PACKAGE_JSON = 'package.json'
const endsInPackageJson = (path) =&gt; path.match(new RegExp(`${PACKAGE_JSON}$`))
const condition = (truthy, newJourney) =&gt; (truthy) ? journey(() =&gt; newJourney)() : false
const mergeDeps = (packageContent) =&gt; ({
  [BLOCK]: BLOCK,
  ...packageContent,
  dependencies: {
    ...packageContent.dependencies,
    ...packageContent.devDependencies
  }
})
&nbsp;
export const depMerge = journey(dirPath =&gt; [
  () =&gt; ({dirPath}),
  ({dirPath}) =&gt; ({endsInPackageJson: endsInPackageJson(dirPath)}),
  ({dirPath, endsInPackageJson}) =&gt; (endsInPackageJson) ? ({pkgPath: dirPath}) : ({pkgPath: path.join(dirPath, PACKAGE_JSON)}),
  async ({pkgPath}) =&gt; ({fileExists: await fileExists(pkgPath)}),
  ({fileExists, pkgPath}) =&gt; condition(fileExists, [
    () =&gt; ({pkgPath}),
    // create new package.json
    async ({pkgPath}) =&gt; ({packageContent: await fs.readJson(pkgPath)}),
    ({packageContent}) =&gt; ({newPackageJson: mergeDeps(packageContent)}),
    // move the original package.json
    ({pkgPath}) =&gt; ({mvPath: path.join(path.dirname(pkgPath), 'original_package.json')}),
    async ({pkgPath, mvPath}) =&gt; ({moveOg: await fs.move(pkgPath, mvPath)}),
    // // write the new package.json
    async ({pkgPath, newPackageJson}) =&gt; ({outputJson: await fs.writeFile(pkgPath, JSON.stringify(newPackageJson, null, 2))})
  ])
])
&nbsp;
export const unDepMerge = journey(dirPath =&gt; [
  () =&gt; ({dirPath}),
  ({dirPath}) =&gt; ({endsInPackageJson: endsInPackageJson(dirPath)}),
  ({dirPath, endsInPackageJson}) =&gt; (endsInPackageJson) ? ({pkgPath: dirPath}) : ({pkgPath: path.join(dirPath, PACKAGE_JSON)}),
  async ({pkgPath}) =&gt; ({newExists: await fileExists(pkgPath)}),
  ({pkgPath}) =&gt; ({mvPath: path.join(path.dirname(pkgPath), 'original_package.json')}),
  async ({mvPath}) =&gt; ({originalExists: await fileExists(mvPath)}),
  async ({pkgPath}) =&gt; ({packageJsonContent: await fs.readJson(pkgPath)}),
  ({packageJsonContent}) =&gt; ({worthy: packageJsonContent[BLOCK] &amp;&amp; packageJsonContent[BLOCK] === BLOCK}),
  ({newExists, originalExists, worthy, pkgPath, mvPath}) =&gt; condition(worthy &amp;&amp; newExists &amp;&amp; originalExists, [
    () =&gt; ({pkgPath, mvPath}),
    async ({pkgPath}) =&gt; ({remove: await fs.remove(pkgPath)}),
    async ({pkgPath, mvPath}) =&gt; ({moveOg: await fs.move(mvPath, pkgPath)})
  ])
])
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Apr 25 2018 23:58:08 GMT-0400 (EDT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
